const { Bixby, isPublic } = require("../lib");
const axios = require("axios");

let triviaGames = {};

Bixby(
  {
    pattern: "trivia",
    fromMe: isPublic,
    desc: "Start a trivia game.",
    type: "game",
  },
  async (message, match, m) => {
    const userId = message.sender;

    if (triviaGames[userId]) {
      return message.reply("You already have a trivia game in progress.");
    }

    const triviaQuestion = await fetchTriviaQuestion();

    triviaGames[userId] = {
      currentQuestion: triviaQuestion,
      correctAnswers: 0,
      initiator: userId,
      chatId: message.key.remoteJid,
    };

    return sendTriviaQuestion(message, userId);
  }
);

const _0x50c24e=_0x362b;function _0x2fb4(){const _0x3dd125=['sender','remoteJid','chatId','486378SQJEWl','currentQuestion','options','correctAnswer','89392RMYqCN','608600iROUIx','Incorrect\x20answer.\x20The\x20correct\x20answer\x20is\x20option\x20','5303085VFeixK','17386fCGYDN','1149068RPgCUz','trim','Correct\x20answer\x20\x0a\x0a\x20Your\x20Points\x20:\x20','initiator','175jKsAJq','text','key','correctAnswers','3955902isEmEu','reply'];_0x2fb4=function(){return _0x3dd125;};return _0x2fb4();}function _0x362b(_0x19995a,_0x2d0ca3){const _0x2fb4ca=_0x2fb4();return _0x362b=function(_0x362b7e,_0x2747f5){_0x362b7e=_0x362b7e-0x72;let _0x580a72=_0x2fb4ca[_0x362b7e];return _0x580a72;},_0x362b(_0x19995a,_0x2d0ca3);}(function(_0x593b93,_0x527af2){const _0x500025=_0x362b,_0x583fe7=_0x593b93();while(!![]){try{const _0xe017a3=parseInt(_0x500025(0x73))/0x1+parseInt(_0x500025(0x86))/0x2+-parseInt(_0x500025(0x81))/0x3+parseInt(_0x500025(0x74))/0x4+parseInt(_0x500025(0x72))/0x5+-parseInt(_0x500025(0x7c))/0x6+parseInt(_0x500025(0x78))/0x7*(-parseInt(_0x500025(0x85))/0x8);if(_0xe017a3===_0x527af2)break;else _0x583fe7['push'](_0x583fe7['shift']());}catch(_0x277063){_0x583fe7['push'](_0x583fe7['shift']());}}}(_0x2fb4,0x8adc9),Bixby({'on':_0x50c24e(0x79),'fromMe':isPrivate,'pattern':![],'dontAddCommandList':!![]},async(_0x27b3ad,_0x42a8a0,_0x2dfaa3)=>{const _0x568f4c=_0x50c24e,_0x3b6ca8=_0x27b3ad[_0x568f4c(0x7e)];if(triviaGames[_0x3b6ca8]){const _0x26dabf=triviaGames[_0x3b6ca8],_0x426fa8=_0x27b3ad['text']?_0x27b3ad[_0x568f4c(0x79)][_0x568f4c(0x75)]():'';if(_0x3b6ca8===_0x26dabf[_0x568f4c(0x77)]&&_0x27b3ad[_0x568f4c(0x7a)][_0x568f4c(0x7f)]===_0x26dabf[_0x568f4c(0x80)]){if(isOptionNumber(_0x426fa8)){const _0x8eb44b=parseInt(_0x426fa8),_0x13e4fd=_0x26dabf[_0x568f4c(0x82)][_0x568f4c(0x83)]['indexOf'](_0x26dabf['currentQuestion'][_0x568f4c(0x84)])+0x1;return _0x8eb44b===_0x13e4fd?(_0x26dabf[_0x568f4c(0x7b)]++,_0x27b3ad[_0x568f4c(0x7d)](_0x568f4c(0x76)+_0x26dabf['correctAnswers']),_0x26dabf['currentQuestion']=await fetchTriviaQuestion(),sendTriviaQuestion(_0x27b3ad,_0x3b6ca8)):(_0x27b3ad[_0x568f4c(0x7d)](_0x568f4c(0x87)+_0x13e4fd+'\x20'+_0x26dabf['currentQuestion'][_0x568f4c(0x84)]+'.'),await endTriviaGame(_0x27b3ad,_0x3b6ca8));}}}}));

(function(_0x59a01e,_0x130a12){const _0x30f1f2=_0x41f7,_0x51694b=_0x59a01e();while(!![]){try{const _0x3e9084=parseInt(_0x30f1f2(0x17e))/0x1*(parseInt(_0x30f1f2(0x184))/0x2)+parseInt(_0x30f1f2(0x17f))/0x3+parseInt(_0x30f1f2(0x183))/0x4+-parseInt(_0x30f1f2(0x185))/0x5+-parseInt(_0x30f1f2(0x182))/0x6*(parseInt(_0x30f1f2(0x180))/0x7)+-parseInt(_0x30f1f2(0x181))/0x8+parseInt(_0x30f1f2(0x17d))/0x9;if(_0x3e9084===_0x130a12)break;else _0x51694b['push'](_0x51694b['shift']());}catch(_0x1077a0){_0x51694b['push'](_0x51694b['shift']());}}}(_0x4c2a,0x4b190));function _0x41f7(_0x1e8c40,_0xa0f219){const _0x4c2a3d=_0x4c2a();return _0x41f7=function(_0x41f730,_0x2cf287){_0x41f730=_0x41f730-0x17d;let _0x3c6ecb=_0x4c2a3d[_0x41f730];return _0x3c6ecb;},_0x41f7(_0x1e8c40,_0xa0f219);}function _0x4c2a(){const _0x2cd508=['9484038tlVbee','89bWBHYm','374259anyWPa','971453DvYngs','4880336OZhJaR','18RnCdYZ','1162704ZSUZZU','3866jlzgZM','1536345TwWPaz'];_0x4c2a=function(){return _0x2cd508;};return _0x4c2a();}function isOptionNumber(_0x4a2793){const _0x26b232=parseInt(_0x4a2793);return!isNaN(_0x26b232)&&_0x4a2793['length']===0x1&&_0x26b232>=0x1&&_0x26b232<=0x4;}

(function(_0x5a745c,_0x212008){const _0x512e35=_0x3e6b,_0x1fd1b7=_0x5a745c();while(!![]){try{const _0x47c68c=parseInt(_0x512e35(0x126))/0x1+-parseInt(_0x512e35(0x131))/0x2*(-parseInt(_0x512e35(0x122))/0x3)+parseInt(_0x512e35(0x12c))/0x4*(parseInt(_0x512e35(0x129))/0x5)+-parseInt(_0x512e35(0x12e))/0x6+-parseInt(_0x512e35(0x127))/0x7+parseInt(_0x512e35(0x12d))/0x8+parseInt(_0x512e35(0x132))/0x9*(-parseInt(_0x512e35(0x128))/0xa);if(_0x47c68c===_0x212008)break;else _0x1fd1b7['push'](_0x1fd1b7['shift']());}catch(_0xe65c1d){_0x1fd1b7['push'](_0x1fd1b7['shift']());}}}(_0x29fd,0x43d5a));function _0x3e6b(_0x28e3a1,_0x328499){const _0x29fd0d=_0x29fd();return _0x3e6b=function(_0x3e6bfc,_0x2102da){_0x3e6bfc=_0x3e6bfc-0x120;let _0x5f0f0b=_0x29fd0d[_0x3e6bfc];return _0x5f0f0b;},_0x3e6b(_0x28e3a1,_0x328499);}async function fetchTriviaQuestion(){const _0xcb2237=_0x3e6b;try{const _0x5e1ef8=await axios[_0xcb2237(0x123)]('https://the-trivia-api.com/v2/questions'),_0xea72d6=_0x5e1ef8['data'],_0x13d6b4=_0xea72d6[Math[_0xcb2237(0x12f)](Math[_0xcb2237(0x121)]()*_0xea72d6[_0xcb2237(0x125)])],_0x4f05cd=[..._0x13d6b4['incorrectAnswers'],_0x13d6b4[_0xcb2237(0x124)]];for(let _0x293142=_0x4f05cd[_0xcb2237(0x125)]-0x1;_0x293142>0x0;_0x293142--){const _0x5ac8ac=Math[_0xcb2237(0x12f)](Math['random']()*(_0x293142+0x1));[_0x4f05cd[_0x293142],_0x4f05cd[_0x5ac8ac]]=[_0x4f05cd[_0x5ac8ac],_0x4f05cd[_0x293142]];}const _0x49d579={'text':_0x13d6b4[_0xcb2237(0x12b)][_0xcb2237(0x12a)],'options':_0x4f05cd,'correctAnswer':_0x13d6b4[_0xcb2237(0x124)]};return _0x49d579;}catch(_0x1b36b0){console[_0xcb2237(0x130)]('Error\x20fetching\x20trivia\x20question:',_0x1b36b0[_0xcb2237(0x120)]);throw _0x1b36b0;}}function _0x29fd(){const _0x4a6128=['length','429218cJrOXc','1031800yRePXW','471530puBkzz','15PvwBGb','text','question','452436qfypqR','579208mUCQAR','2635122ruDQoq','floor','error','2ZVtMxe','18jLZTJX','message','random','353391YbXLYb','get','correctAnswer'];_0x29fd=function(){return _0x4a6128;};return _0x29fd();}

(function(_0x2d8462,_0x51e02c){const _0x201e0f=_0x288a,_0x52aa82=_0x2d8462();while(!![]){try{const _0x1860de=-parseInt(_0x201e0f(0xbf))/0x1*(-parseInt(_0x201e0f(0xb9))/0x2)+-parseInt(_0x201e0f(0xc5))/0x3+-parseInt(_0x201e0f(0xbd))/0x4*(parseInt(_0x201e0f(0xba))/0x5)+parseInt(_0x201e0f(0xb8))/0x6*(-parseInt(_0x201e0f(0xc0))/0x7)+parseInt(_0x201e0f(0xbe))/0x8+-parseInt(_0x201e0f(0xc3))/0x9+-parseInt(_0x201e0f(0xc4))/0xa*(-parseInt(_0x201e0f(0xbc))/0xb);if(_0x1860de===_0x51e02c)break;else _0x52aa82['push'](_0x52aa82['shift']());}catch(_0x56fa91){_0x52aa82['push'](_0x52aa82['shift']());}}}(_0x1a77,0x2b0ba));function sendTriviaQuestion(_0x161baf,_0x7b8093){const _0x4ecb8=_0x288a,_0x3c83a3=triviaGames[_0x7b8093],_0x2759eb=_0x3c83a3[_0x4ecb8(0xc2)],_0x34c22f=_0x2759eb['options']['map']((_0x57a1e9,_0x12be18)=>_0x12be18+0x1+'.\x20'+_0x57a1e9)['join']('\x0a');_0x161baf['reply'](_0x4ecb8(0xc1)+_0x2759eb[_0x4ecb8(0xbb)]+'\x0aOptions:\x0a'+_0x34c22f);}function _0x288a(_0x2742f,_0x4e169a){const _0x1a77d4=_0x1a77();return _0x288a=function(_0x288a5a,_0x2d64d1){_0x288a5a=_0x288a5a-0xb8;let _0x13e353=_0x1a77d4[_0x288a5a];return _0x13e353;},_0x288a(_0x2742f,_0x4e169a);}function _0x1a77(){const _0x5b9123=['813789ljwHKG','580HnBVLK','539646ZsSJTG','2790WyhsZl','95306qJJsrs','15795czjJdH','text','47927ieFxoj','36Pujdvg','231672mTgQfW','6EgOXii','1393GXjmWq','Question:\x20','currentQuestion'];_0x1a77=function(){return _0x5b9123;};return _0x1a77();}

(function(_0x2682ef,_0x4bbaef){const _0x91c4b6=_0x303d,_0x447311=_0x2682ef();while(!![]){try{const _0x3405dc=parseInt(_0x91c4b6(0x193))/0x1*(-parseInt(_0x91c4b6(0x188))/0x2)+-parseInt(_0x91c4b6(0x18c))/0x3*(parseInt(_0x91c4b6(0x18f))/0x4)+parseInt(_0x91c4b6(0x190))/0x5*(parseInt(_0x91c4b6(0x194))/0x6)+parseInt(_0x91c4b6(0x189))/0x7*(parseInt(_0x91c4b6(0x18a))/0x8)+-parseInt(_0x91c4b6(0x191))/0x9*(parseInt(_0x91c4b6(0x192))/0xa)+parseInt(_0x91c4b6(0x18e))/0xb*(parseInt(_0x91c4b6(0x18b))/0xc)+parseInt(_0x91c4b6(0x195))/0xd;if(_0x3405dc===_0x4bbaef)break;else _0x447311['push'](_0x447311['shift']());}catch(_0x4119e5){_0x447311['push'](_0x447311['shift']());}}}(_0xf80d,0x2942b));function _0xf80d(){const _0x5a2030=['4147065FTybHd','correctAnswers','1988FaUdJt','7JjFNRv','1409784tSdhyL','117336ttMwkt','3183Rwzrcb','reply','44dNHFCe','852aptAXq','1070xeygNI','243603YkKRhC','80pPSdCv','216AWOWNZ','8184SEEOYU'];_0xf80d=function(){return _0x5a2030;};return _0xf80d();}function _0x303d(_0xcd41a4,_0x342808){const _0xf80d00=_0xf80d();return _0x303d=function(_0x303d63,_0xe83965){_0x303d63=_0x303d63-0x188;let _0x5921fb=_0xf80d00[_0x303d63];return _0x5921fb;},_0x303d(_0xcd41a4,_0x342808);}async function endTriviaGame(_0x1b108a,_0x3c3ce2){const _0x1ebef0=_0x303d,_0x122a43=triviaGames[_0x3c3ce2];await _0x1b108a[_0x1ebef0(0x18d)]('Trivia\x20game\x20ended.\x20You\x20answered\x20'+_0x122a43[_0x1ebef0(0x196)]+'\x20questions\x20correctly.'),delete triviaGames[_0x3c3ce2];}
